SELECT ISNULL((SELECT NAME FROM CUSTOMER WHERE ID = (SELECT SUBSTRING(PART_ID,1,4) FROM WORK_ORDER WHERE dbo.REQUIREMENT.WORKORDER_BASE_ID = BASE_ID AND SUB_ID = 0)),'PRODUCCION') [CLIENTE],
       WORKORDER_BASE_ID,(SELECT PART_ID FROM WORK_ORDER WHERE dbo.REQUIREMENT.WORKORDER_BASE_ID = BASE_ID AND SUB_ID = 0) [CODIGO_PT],
       (SELECT DESCRIPTION FROM PART WHERE ID = (SELECT PART_ID FROM WORK_ORDER WHERE dbo.REQUIREMENT.WORKORDER_BASE_ID = BASE_ID AND SUB_ID = 0)) [DESCRIPCION_PT],
       (SELECT STATUS FROM WORK_ORDER WHERE dbo.REQUIREMENT.WORKORDER_BASE_ID = BASE_ID AND SUB_ID = 0) [ESTADO_OT],
       (SELECT CREATE_DATE FROM WORK_ORDER WHERE dbo.REQUIREMENT.WORKORDER_BASE_ID = BASE_ID AND SUB_ID = 0) [FECHA_CREA_OT],
       REQUIRED_DATE,OPERATION_SEQ_NO,PIECE_NO,REQUIREMENT.PART_ID,
       (SELECT DESCRIPTION FROM PART WHERE ID = REQUIREMENT.PART_ID) [DESCRIPTION],
       REQUIREMENT.STATUS [ESTADO_MP],QTY_PER,SCRAP_PERCENT,CALC_QTY,
       ISSUED_QTY,
       (SELECT SUM(QTY- COMMITTED_QTY) FROM PART_LOCATION WHERE PART_ID = REQUIREMENT.PART_ID) [SOTCK],
       UNIT_MATERIAL_COST,UNIT_LABOR_COST,UNIT_BURDEN_COST,
       UNIT_SERVICE_COST,REQUIREMENT.EST_MATERIAL_COST,REQUIREMENT.EST_LABOR_COST,REQUIREMENT.EST_BURDEN_COST,REQUIREMENT.EST_SERVICE_COST,
       CASE WHEN SUBSTRING((SELECT PART_ID FROM WORK_ORDER WHERE dbo.REQUIREMENT.WORKORDER_BASE_ID = BASE_ID AND SUB_ID = 0),LEN((SELECT PART_ID FROM WORK_ORDER WHERE dbo.REQUIREMENT.WORKORDER_BASE_ID = BASE_ID AND SUB_ID = 0))-2,1) = 'A' THEN 'PRODUCTOS INTERNOS'
            WHEN SUBSTRING((SELECT PART_ID FROM WORK_ORDER WHERE dbo.REQUIREMENT.WORKORDER_BASE_ID = BASE_ID AND SUB_ID = 0),LEN((SELECT PART_ID FROM WORK_ORDER WHERE dbo.REQUIREMENT.WORKORDER_BASE_ID = BASE_ID AND SUB_ID = 0))-2,1) = 'C' THEN 'COQUILLA'
            WHEN SUBSTRING((SELECT PART_ID FROM WORK_ORDER WHERE dbo.REQUIREMENT.WORKORDER_BASE_ID = BASE_ID AND SUB_ID = 0),LEN((SELECT PART_ID FROM WORK_ORDER WHERE dbo.REQUIREMENT.WORKORDER_BASE_ID = BASE_ID AND SUB_ID = 0))-2,1) = 'D' THEN 'MODELERÍA'
            WHEN SUBSTRING((SELECT PART_ID FROM WORK_ORDER WHERE dbo.REQUIREMENT.WORKORDER_BASE_ID = BASE_ID AND SUB_ID = 0),LEN((SELECT PART_ID FROM WORK_ORDER WHERE dbo.REQUIREMENT.WORKORDER_BASE_ID = BASE_ID AND SUB_ID = 0))-2,1) = 'E' THEN 'ENSAMBLAJE'
            WHEN SUBSTRING((SELECT PART_ID FROM WORK_ORDER WHERE dbo.REQUIREMENT.WORKORDER_BASE_ID = BASE_ID AND SUB_ID = 0),LEN((SELECT PART_ID FROM WORK_ORDER WHERE dbo.REQUIREMENT.WORKORDER_BASE_ID = BASE_ID AND SUB_ID = 0))-2,1) = 'G' THEN 'GRANALLA'
            WHEN SUBSTRING((SELECT PART_ID FROM WORK_ORDER WHERE dbo.REQUIREMENT.WORKORDER_BASE_ID = BASE_ID AND SUB_ID = 0),LEN((SELECT PART_ID FROM WORK_ORDER WHERE dbo.REQUIREMENT.WORKORDER_BASE_ID = BASE_ID AND SUB_ID = 0))-2,1) = 'I' THEN 'FUNDICIÓN A PRESIÓN'
            WHEN SUBSTRING((SELECT PART_ID FROM WORK_ORDER WHERE dbo.REQUIREMENT.WORKORDER_BASE_ID = BASE_ID AND SUB_ID = 0),LEN((SELECT PART_ID FROM WORK_ORDER WHERE dbo.REQUIREMENT.WORKORDER_BASE_ID = BASE_ID AND SUB_ID = 0))-2,1) = 'L' THEN 'PLANOS'
            WHEN SUBSTRING((SELECT PART_ID FROM WORK_ORDER WHERE dbo.REQUIREMENT.WORKORDER_BASE_ID = BASE_ID AND SUB_ID = 0),LEN((SELECT PART_ID FROM WORK_ORDER WHERE dbo.REQUIREMENT.WORKORDER_BASE_ID = BASE_ID AND SUB_ID = 0))-2,1) = 'M' THEN 'MOLDEO MANUAL'
            WHEN SUBSTRING((SELECT PART_ID FROM WORK_ORDER WHERE dbo.REQUIREMENT.WORKORDER_BASE_ID = BASE_ID AND SUB_ID = 0),LEN((SELECT PART_ID FROM WORK_ORDER WHERE dbo.REQUIREMENT.WORKORDER_BASE_ID = BASE_ID AND SUB_ID = 0))-2,1) = 'N' THEN 'PINTURA'
            WHEN SUBSTRING((SELECT PART_ID FROM WORK_ORDER WHERE dbo.REQUIREMENT.WORKORDER_BASE_ID = BASE_ID AND SUB_ID = 0),LEN((SELECT PART_ID FROM WORK_ORDER WHERE dbo.REQUIREMENT.WORKORDER_BASE_ID = BASE_ID AND SUB_ID = 0))-2,1) = 'G' THEN 'GRANALLA'
            WHEN SUBSTRING((SELECT PART_ID FROM WORK_ORDER WHERE dbo.REQUIREMENT.WORKORDER_BASE_ID = BASE_ID AND SUB_ID = 0),LEN((SELECT PART_ID FROM WORK_ORDER WHERE dbo.REQUIREMENT.WORKORDER_BASE_ID = BASE_ID AND SUB_ID = 0))-2,1) = 'P' THEN 'CASTING'
            WHEN SUBSTRING((SELECT PART_ID FROM WORK_ORDER WHERE dbo.REQUIREMENT.WORKORDER_BASE_ID = BASE_ID AND SUB_ID = 0),LEN((SELECT PART_ID FROM WORK_ORDER WHERE dbo.REQUIREMENT.WORKORDER_BASE_ID = BASE_ID AND SUB_ID = 0))-2,1) = 'Q' THEN 'MOLDEO EN MAQUINA'
            WHEN SUBSTRING((SELECT PART_ID FROM WORK_ORDER WHERE dbo.REQUIREMENT.WORKORDER_BASE_ID = BASE_ID AND SUB_ID = 0),LEN((SELECT PART_ID FROM WORK_ORDER WHERE dbo.REQUIREMENT.WORKORDER_BASE_ID = BASE_ID AND SUB_ID = 0))-2,1) = 'T' THEN 'METALMECÁNICA'
            WHEN SUBSTRING((SELECT PART_ID FROM WORK_ORDER WHERE dbo.REQUIREMENT.WORKORDER_BASE_ID = BASE_ID AND SUB_ID = 0),LEN((SELECT PART_ID FROM WORK_ORDER WHERE dbo.REQUIREMENT.WORKORDER_BASE_ID = BASE_ID AND SUB_ID = 0))-2,1) = 'F' THEN 'CURA EN FRIO'
            ELSE '' END AS [NOMBRE PROCESO]
  FROM REQUIREMENT 
 WHERE WORKORDER_TYPE = 'W'
   AND (SELECT STATUS FROM WORK_ORDER WHERE dbo.REQUIREMENT.WORKORDER_BASE_ID = BASE_ID AND SUB_ID = 0) <> 'X'
   AND (SELECT YEAR(CREATE_DATE) FROM WORK_ORDER WHERE dbo.REQUIREMENT.WORKORDER_BASE_ID = BASE_ID AND SUB_ID = 0) = 2015