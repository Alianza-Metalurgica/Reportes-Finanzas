SELECT COL.CUST_ORDER_ID AS [PEDIDO],COL.PART_ID AS [CODIGO],CASE WHEN COL.PART_ID LIKE 'SERV_%' THEN COL.MISC_REFERENCE ELSE P.DESCRIPTION END [DESCRIPCIÓN],
       C.[NAME] AS [CLIENTE],COL.ORDER_QTY AS [CANT],ISNULL(COL.USER_10,'') AS [O/T],COL.CUST_ORDER_ID AS [PEDIDO],
       CASE WHEN SUBSTRING(COL.PART_ID,LEN(COL.PART_ID)-2,1) = 'A' THEN 'PRODUCTOS INTERNOS'
            WHEN SUBSTRING(COL.PART_ID,LEN(COL.PART_ID)-2,1) = 'C' THEN 'COQUILLA'
            WHEN SUBSTRING(COL.PART_ID,LEN(COL.PART_ID)-2,1) = 'D' THEN 'MODELERÍA'
            WHEN SUBSTRING(COL.PART_ID,LEN(COL.PART_ID)-2,1) = 'E' THEN 'ENSAMBLAJE'
            WHEN SUBSTRING(COL.PART_ID,LEN(COL.PART_ID)-2,1) = 'G' THEN 'GRANALLA'
            WHEN SUBSTRING(COL.PART_ID,LEN(COL.PART_ID)-2,1) = 'I' THEN 'FUNDICIÓN A PRESIÓN'
            WHEN SUBSTRING(COL.PART_ID,LEN(COL.PART_ID)-2,1) = 'L' THEN 'PLANOS'
            WHEN SUBSTRING(COL.PART_ID,LEN(COL.PART_ID)-2,1) = 'M' THEN 'MOLDEO MANUAL'
            WHEN SUBSTRING(COL.PART_ID,LEN(COL.PART_ID)-2,1) = 'N' THEN 'PINTURA'
            WHEN SUBSTRING(COL.PART_ID,LEN(COL.PART_ID)-2,1) = 'P' THEN 'CASTING'
            WHEN SUBSTRING(COL.PART_ID,LEN(COL.PART_ID)-2,1) = 'Q' THEN 'MOLDEO EN MAQUINA'
            WHEN SUBSTRING(COL.PART_ID,LEN(COL.PART_ID)-2,1) = 'T' THEN 'METALMECÁNICA'
            WHEN SUBSTRING(COL.PART_ID,LEN(COL.PART_ID)-2,1) = 'F' THEN 'CURA EN FRIO'
            WHEN SUBSTRING(COL.PART_ID,LEN(COL.PART_ID)-2,1) = 'H' THEN 'TEFLONADO'
            WHEN COL.PART_ID LIKE 'SERV_%' THEN 'SERVICIO A TERCEROS'
            ELSE 'TTO. TERMICO' END AS [NOMBRE PROCESO],
            CASE WHEN (SELECT USER_5 FROM WORK_ORDER WHERE BASE_ID = COL.USER_10 AND SUB_ID = 0) = 'A01' THEN 'ARENADO'
                 WHEN (SELECT USER_5 FROM WORK_ORDER WHERE BASE_ID = COL.USER_10 AND SUB_ID = 0) = 'A02' THEN 'SIN ARENAR (NATURAL)'
                 WHEN (SELECT USER_5 FROM WORK_ORDER WHERE BASE_ID = COL.USER_10 AND SUB_ID = 0) = 'A03' THEN 'CORINDON (GRANALLADO)'
                 WHEN (SELECT USER_5 FROM WORK_ORDER WHERE BASE_ID = COL.USER_10 AND SUB_ID = 0) = 'A04' THEN 'GRANALLADO C/ MICROESFERA DE VIDRIO'
                 WHEN (SELECT USER_5 FROM WORK_ORDER WHERE BASE_ID = COL.USER_10 AND SUB_ID = 0) = 'A05' THEN 'PULIDO'
                 WHEN (SELECT USER_5 FROM WORK_ORDER WHERE BASE_ID = COL.USER_10 AND SUB_ID = 0) = 'A06' THEN 'CROMADO'
                 WHEN (SELECT USER_5 FROM WORK_ORDER WHERE BASE_ID = COL.USER_10 AND SUB_ID = 0) = 'A00' THEN 'OTROS'
                 ELSE '' END AS [ACABADOS],                                                                                       
            --ISNULL((SELECT SUM(GOOD_QTY) FROM LABOR_TICKET WHERE WORKORDER_BASE_ID = ISNULL(COL.USER_10,'') AND RESOURCE_ID IN ('EFUN','MINY2','ECOQ1','MMOLD')),0) AS [CANT FUN],
            (SELECT TOP 1 TRANSACTION_DATE FROM INVENTORY_TRANS WHERE WORKORDER_BASE_ID = ISNULL(COL.USER_10,'') AND TYPE = 'I' AND CLASS = 'R' ORDER BY 1 DESC) AS [FEC ING APT],
            CO.ORDER_DATE AS [F. INGRESO],C.[NAME] AS [CLIENTE],
       (COL.ORDER_QTY - COL.TOTAL_SHIPPED_QTY) AS [SALDO X DESP],(PL.QTY) AS [STOCK],
       (SELECT SUM(QTY) FROM INVENTORY_TRANS WHERE WORKORDER_BASE_ID = ISNULL(COL.USER_10,'') AND TYPE = 'I' AND CLASS = 'R') [STOCK OT],COL.TOTAL_SHIPPED_QTY AS [DESPACHADO],
        COL.DESIRED_SHIP_DATE AS [FEC DES DESPACHO],COL.LAST_SHIPPED_DATE AS [FEC DESPACHO],COL.PROMISE_DATE AS [FEC DES APT],COL.PROMISE_DEL_DATE AS [FECHA REPROG],
(SELECT CAST(CAST(BITS AS VARBINARY(128)) AS VARCHAR(150)) FROM CUST_LINE_BINARY WHERE CUST_ORDER_ID = COL.CUST_ORDER_ID AND CUST_ORDER_LINE_NO = COL.LINE_NO) AS [OBSERVACIONES] 
  FROM CUST_ORDER_LINE COL
       LEFT JOIN CUSTOMER_ORDER CO ON COL.CUST_ORDER_ID = CO.ID
       LEFT JOIN PART P ON COL.PART_ID = P.ID
       LEFT JOIN PART_LOCATION PL ON PL.PART_ID = P.ID
       LEFT JOIN CUSTOMER C ON CO.CUSTOMER_ID = C.ID
 WHERE CO.ORDER_DATE > '20121231' AND CO.STATUS IN ('R') 
   AND PL.LOCATION_ID NOT IN ('02PRODINT')
 ORDER BY CO.ORDER_DATE DESC